<div class="backtest-container">
  <h2>Strategy Backtest</h2>

  <div class="backtest-form">
    <div class="form-group">
      <label for="days">Backtest Period (days):</label>
      <input
        type="number"
        id="days"
        name="days"
        [(ngModel)]="config.days"
        min="1"
        max="365"
        class="form-control">
      <small>Test strategy performance over historical data (1-365 days)</small>
    </div>

    <div class="form-group">
      <label for="initialBalance">Initial Balance ($):</label>
      <input
        type="number"
        id="initialBalance"
        name="initialBalance"
        [(ngModel)]="config.initialBalance"
        min="100"
        step="100"
        class="form-control">
      <small>Starting capital for the backtest</small>
    </div>

    <button
      (click)="runBacktest()"
      class="btn-run"
      [disabled]="loading">
      <span *ngIf="!loading">Run Backtest</span>
      <span *ngIf="loading">Running...</span>
    </button>
  </div>

  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>

  <!-- Logs Window -->
  <div *ngIf="logs.length > 0" class="logs-container">
    <h3>Execution Logs</h3>
    <div class="logs-window">
      <div *ngFor="let log of logs" class="log-entry">{{ log }}</div>
    </div>
  </div>

  <!-- Results Section -->
  <div *ngIf="result" class="results" [ngClass]="getResultClass()">
    <h3>{{ getPerformanceIcon() }} Backtest Results</h3>

    <!-- Main Performance Card -->
    <div class="performance-card">
      <div class="performance-main">
        <div class="metric">
          <span class="metric-label">Profit/Loss</span>
          <span class="metric-value" [class.positive]="result.profitLoss >= 0" [class.negative]="result.profitLoss < 0">
            ${{ result.profitLoss.toFixed(2) }}
          </span>
        </div>
        <div class="metric">
          <span class="metric-label">Return</span>
          <span class="metric-value" [class.positive]="result.profitLossPercentage >= 0" [class.negative]="result.profitLossPercentage < 0">
            {{ result.profitLossPercentage.toFixed(2) }}%
          </span>
        </div>
      </div>
    </div>

    <!-- Detailed Results Grid -->
    <div class="result-grid">
      <div class="result-item">
        <span class="label">Period:</span>
        <span class="value">{{ result.days }} days</span>
      </div>

      <div class="result-item">
        <span class="label">Initial Balance:</span>
        <span class="value">${{ result.initialBalance.toFixed(2) }}</span>
      </div>

      <div class="result-item">
        <span class="label">Final Balance:</span>
        <span class="value">${{ result.finalBalance.toFixed(2) }}</span>
      </div>

      <div class="result-item">
        <span class="label">Total Trades:</span>
        <span class="value">{{ result.totalTrades }}</span>
      </div>

      <div class="result-item">
        <span class="label">Buy Trades:</span>
        <span class="value">{{ result.buyTrades }}</span>
      </div>

      <div class="result-item">
        <span class="label">Sell Trades:</span>
        <span class="value">{{ result.sellTrades }}</span>
      </div>
    </div>

    <!-- Performance Summary -->
    <div class="performance-summary">
      <h4>Performance Summary</h4>
      <p *ngIf="result.profitLoss > 0" class="success">
        Your strategy would have made a profit of ${{ result.profitLoss.toFixed(2) }}
        over {{ result.days }} days! That's a {{ result.profitLossPercentage.toFixed(2) }}% return.
      </p>
      <p *ngIf="result.profitLoss < 0" class="warning">
        Your strategy would have lost ${{ Math.abs(result.profitLoss).toFixed(2) }}
        over {{ result.days }} days ({{ result.profitLossPercentage.toFixed(2) }}%). Consider adjusting your parameters.
      </p>
      <p *ngIf="result.profitLoss === 0" class="neutral">
        Your strategy broke even over {{ result.days }} days.
      </p>
    </div>
  </div>
</div>
