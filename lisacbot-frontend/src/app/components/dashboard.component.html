<div class="dashboard-container">
  <h2>Bot Status Dashboard</h2>

  <div class="status-header">
    <div class="status-indicator" [class.active]="botStatus.running">
      <span class="dot"></span>
      <span>{{ botStatus.running ? 'Active' : 'Stopped' }}</span>
    </div>
    <button (click)="refreshData()" class="btn-refresh">Refresh</button>
  </div>

  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">ðŸ’°</div>
      <div class="stat-content">
        <div class="stat-label">Cash Balance</div>
        <div class="stat-value">${{ botStatus.balance.toFixed(2) }}</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">â‚¿</div>
      <div class="stat-content">
        <div class="stat-label">BTC Holdings</div>
        <div class="stat-value">{{ botStatus.holdings.toFixed(6) }} BTC</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">ðŸ“ˆ</div>
      <div class="stat-content">
        <div class="stat-label">BTC Price</div>
        <div class="stat-value">${{ botStatus.currentPrice.toFixed(2) }}</div>
      </div>
    </div>

    <div class="stat-card highlight">
      <div class="stat-icon">ðŸ’¼</div>
      <div class="stat-content">
        <div class="stat-label">Total Portfolio Value</div>
        <div class="stat-value">${{ botStatus.totalValue.toFixed(2) }}</div>
      </div>
    </div>

    <div class="stat-card" [ngClass]="getMarketCycleClass()">
      <div class="stat-icon">ðŸ”„</div>
      <div class="stat-content">
        <div class="stat-label">Market Cycle</div>
        <div class="stat-value">{{ botStatus.marketCycle || 'N/A' }}</div>
      </div>
    </div>
  </div>

  <div class="chart-panel">
    <h3>BTC Price Evolution</h3>
    <div class="chart-container">
      <canvas baseChart
              [data]="lineChartData"
              [options]="lineChartOptions"
              type="line">
      </canvas>
    </div>
  </div>

  <div class="trade-history-panel">
    <h3>Trade History</h3>
    <div *ngIf="displayedTrades.length === 0" class="no-trades">
      No trades executed yet.
    </div>
    <div *ngIf="displayedTrades.length > 0" class="trades-table-container">
      <table class="trades-table">
        <thead>
          <tr>
            <th>Date/Time</th>
            <th>Type</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Balance After</th>
            <th>P&L %</th>
            <th>Strategy</th>
            <th>Cycle</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let trade of displayedTrades" [ngClass]="getTradeTypeClass(trade.type)">
            <td>{{ trade.timestamp | date:'short' }}</td>
            <td class="trade-type">
              <span class="badge" [ngClass]="getTradeTypeClass(trade.type)">
                {{ trade.type }}
              </span>
            </td>
            <td>${{ trade.price.toFixed(2) }}</td>
            <td>{{ trade.quantity.toFixed(6) }}</td>
            <td>${{ trade.balanceAfter.toFixed(2) }}</td>
            <td [class.positive]="trade.profitLossPercentage && trade.profitLossPercentage > 0"
                [class.negative]="trade.profitLossPercentage && trade.profitLossPercentage < 0">
              {{ trade.profitLossPercentage ? trade.profitLossPercentage.toFixed(2) + '%' : 'N/A' }}
            </td>
            <td>{{ trade.strategy }}</td>
            <td>{{ trade.marketCycle }}</td>
          </tr>
        </tbody>
      </table>
      <div *ngIf="trades.length > maxDisplayedTrades" class="trade-count">
        Showing {{ displayedTrades.length }} of {{ trades.length }} trades
      </div>
    </div>
  </div>

  <div class="info-panel">
    <h3>Information</h3>
    <p><strong>Last Update:</strong> {{ botStatus.lastUpdate | date:'medium' }}</p>
    <p class="note">
      Real-time data from backend API. Chart shows the last {{maxDataPoints}} price updates.
    </p>
  </div>
</div>
